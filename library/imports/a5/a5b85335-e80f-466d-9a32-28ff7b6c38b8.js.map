{"version":3,"sources":["../../../../../assets/src/role/assets/src/role/platform-generator.js"],"names":["cc","Class","extends","Component","properties","platform_list","move_speed","platform_prafab","Prefab","platform_layer","Node","gold_group_list","maxMoveSpeed","initPlatforms","list","forEach","element","setAnchorPoint","generate","last_platform","random_num","Math","random","floor","platform_temp","instantiate","layer_size","getContentSize","x","width","y","height","log","max_offy","push","addChild","index","gold_group","platform_size","setPosition","length","update","dt","platform","remove_count","list_new","getBoundingBox","xMax","removeFromParent","winSize","director","getWinSize","last_platform_bounding_box","right_x"],"mappings":"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","file":"platform-generator.js","sourceRoot":"../../../../../assets/src/role","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n        platform_list:[],\n        move_speed:0.1,\n        platform_prafab: [cc.Prefab],\n        platform_layer: cc.Node,\n        gold_group_list: [cc.Prefab],\n        maxMoveSpeed:8, //平台最大移动速度\n    },\n\n    initPlatforms: function (list) {\n        this.platform_list = list;\n\n        list.forEach(function(element) {\n            element.setAnchorPoint(0, 0);\n        }, this);\n    },\n\n    generate: function (last_platform) {\n        //随机N种平台\n        var random_num = Math.random() * 4;\n        random_num = Math.floor(random_num);\n\n        var platform_temp = cc.instantiate(this.platform_prafab[random_num]);\n        platform_temp.setAnchorPoint(0,0);\n\n        /**\n         *设置坐标 \n         */\n\n        //x\n        var layer_size = this.platform_layer.getContentSize();\n        platform_temp.x = layer_size.width;\n\n        //随机Y值(不能太高，所以-100)\n        platform_temp.y = Math.random() * (layer_size.height - 100);\n        cc.log(platform_temp.y);\n\n        //防止Y对于前面的平台过高，跳不上去\n        var max_offy = 100;\n        if (platform_temp.y > last_platform.y + max_offy) {\n            platform_temp.y = last_platform.y + max_offy;\n        }\n\n        \n        //添加到节点\n        this.platform_list.push(platform_temp);\n        this.platform_layer.addChild(platform_temp);\n\n        //一定的几率平台添加金币\n        // if (Math.random() >= 0.5) {\n            var index = Math.random() * 3;\n            index = Math.floor(index);\n            var gold_group = cc.instantiate(this.gold_group_list[index]);\n            var platform_size = platform_temp.getContentSize();\n            gold_group.setPosition(platform_size.width / 2, platform_size.height);\n            platform_temp.addChild(gold_group);\n        // }\n\n        cc.log(\"产出一个平台,平台数=\", this.platform_list.length);\n    },\n\n    // // use this for initialization\n    // onLoad: function () {\n    //     this.schedule(this.onAddSpeed,10);\n    // },\n\n    // onAddSpeed:function(){\n    //     this.move_speed += 0.1;\n    // },\n\n    // onDestroy: function onDisabled() {\n    //      this.unschedule(this.onAddSpeed);\n    // },\n\n    // called every frame, uncomment this function to activate update callback\n    update: function (dt) {\n\n        var platform;\n        var remove_count = 0;\n        var list_new = [];\n        for (var index = 0; index < this.platform_list.length; index++) {\n            platform = this.platform_list[index];\n            platform.x -= this.move_speed;\n\n            if (platform.getBoundingBox().xMax > 0) {\n                list_new.push(platform);\n            }\n            else{\n                platform.removeFromParent();\n            }\n        }\n\n        this.platform_list = list_new;\n\n        if (!platform) {\n            return;\n        }\n\n        var winSize = cc.director.getWinSize();\n        var last_platform_bounding_box = platform.getBoundingBox();\n        var right_x = last_platform_bounding_box.x + last_platform_bounding_box.width;\n\n        if (right_x < winSize.width * 0.8) {\n            this.generate(platform)\n        }\n\n        //平台移动速度变更\n        if (this.move_speed < this.maxMoveSpeed) {\n            this.move_speed += 0.001; \n        }\n    },\n});\n"]}